$("#tags").textext({plugins:"tags autocomplete"}).bind("getSuggestions",function(a,b){"use strict";var c=$(this).data("suggestions"),d=c.split(","),e=$(a.target).textext()[0],f=(b?b.query:"")||"";$(this).trigger("setSuggestions",{result:e.itemManager().filter(d,f)})}).bind("isTagAllowed",function(a,b){"use strict";var c=$(a.target).textext()[0].tags()._formData,d=!0;if($.each(c,function(a,c){c===b.tag&&(d=!1)}),!d){var e=[b.tag,"is already listed."].join(" ");alert(e),b.result=!1}}),$(function(){"use strict";var a=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"pickfiles",container:document.getElementById("uploader"),url:"/admin/file/uploadimage",flash_swf_url:"/admin/themes/jmgroup/plupload/Moxie.swf",silverlight_xap_url:"/admin/themes/jmgroup/plupload/Moxie.xap",filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg,gif,png,bmp"}]},init:{PostInit:function(){},FilesAdded:function(b,c){var d=document.getElementById("filelist");plupload.each(c,function(a){$(d).append('<div id="'+a.id+'" class="photo-zone large-4 medium-6 columns"><table cellpadding="0" cellspacing="0"><tr><td class="controls"><strong class="progress radius"></strong></td></tr><tr><td class="edit"><span class="name">'+a.name+" ("+plupload.formatSize(a.size)+')</span></td></tr><tr><td class="caption"><textarea rows="4" name="Picture['+a.id+'][caption]" placeholder="Say something about this photo."></textarea></td></tr></table></div>')}),a.start()},UploadProgress:function(a,b){var c=document.getElementById(b.id).getElementsByTagName("strong")[0];$(c).html('<span class="meter" style="width: '+b.percent+'%">'+b.percent+"%</span>")},FileUploaded:function(a,b,c){var d=JSON.parse(c.response),e=document.getElementById(b.id).getElementsByTagName("strong")[0],f=document.getElementById(b.id).getElementsByClassName("edit")[0],g=new Image;d.hasOwnProperty("result")?(e.className+=" success",g.src=d.result.showUrl+d.result.fileName+"."+d.result.fileExt,g.alt="response.result.fileName"):(e.className+=" alert",g.src="",g.alt="error"),g.onload=function(){var a=f.getElementsByClassName("name")[0];$(a).empty().addClass("overflow"),f.appendChild(g)},$.get("/admin/file/processimage",{id:d.id},function(a){var b=JSON.parse(a),c=f.getElementsByClassName("name")[0];g.src=b.result.showUrl+b.result.fileName+"-thumb-upload."+b.result.fileExt,c.className=""});var h=document.getElementById(b.id).getElementsByClassName("controls")[0];$(h).empty().append('<label><input type="radio" name="Picture['+b.id+'][main]" value="'+d.id+'" /> Main picture</label>').append('<a class="delete-image" data-id="'+d.id+'" href="javascript:;"><i class="fa fa-trash-o"></i></a>');var i=document.getElementById(b.id).getElementsByClassName("caption")[0];$(i).append('<input type="hidden" name="Picture['+b.id+'][id]" value="'+d.id+'" />')},UploadComplete:function(a,b){},Error:function(a,b){document.getElementById("console").innerHTML+="\nError #"+b.code+": "+b.message}}});a.init(),$("#filelist").on("click",".delete-image",function(){var a=$(this).data("id"),b=$(this);$.post("/admin/file/delete?id="+a,{},function(a){var c=JSON.parse(a);c.hasOwnProperty("result")&&b.parents(".photo-zone").remove()})})});