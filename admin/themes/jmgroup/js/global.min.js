var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"pickfiles",container:document.getElementById("uploader"),url:"/admin/file/uploadimage",flash_swf_url:"/admin/themes/jmgroup/plupload/Moxie.swf",silverlight_xap_url:"/admin/themes/jmgroup/plupload/Moxie.xap",filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg,gif,png,bmp"}]},init:{PostInit:function(){document.getElementById("filelist").innerHTML=""},FilesAdded:function(a,b){plupload.each(b,function(a){document.getElementById("filelist").innerHTML+='<div id="'+a.id+'" class="photo-zone large-4 medium-6 columns"><table cellpadding="0" cellspacing="0"><tr><td class="controls"><strong class="progress radius"></strong></td></tr><tr><td class="edit"><span class="name">'+a.name+" ("+plupload.formatSize(a.size)+')</span></td></tr><tr><td class="caption"><textarea rows="4" placeholder="Say something about this photo."></textarea></td></tr></table></div>'}),uploader.start()},UploadProgress:function(a,b){document.getElementById(b.id).getElementsByTagName("strong")[0].innerHTML='<span class="meter" style="width: '+b.percent+'%">'+b.percent+"%</span>"},FileUploaded:function(a,b,c){var d=JSON.parse(c.response),e=document.getElementById(b.id).getElementsByTagName("strong")[0],f=document.getElementById(b.id).getElementsByClassName("edit")[0],g=new Image;d.hasOwnProperty("result")?(e.className+=" success",g.src=d.result.showUrl+d.result.fileName+"."+d.result.fileExt,g.alt="response.result.fileName"):(e.className+=" alert",g.src="",g.alt="error"),g.onload=function(){var a=f.getElementsByClassName("name")[0];$(a).empty().addClass("overflow"),f.appendChild(g)},$.get("/admin/file/processimage",{id:d.id},function(a){var b=JSON.parse(a),c=f.getElementsByClassName("name")[0];g.src=b.result.showUrl+b.result.fileName+"-thumb-upload."+b.result.fileExt,c.className=""});var h=document.getElementById(b.id).getElementsByClassName("controls")[0];$(h).empty().append('<label><input type="radio" name="main-image" value="'+d.id+'" /> Main picture</label>').append('<a class="delete-image" data-id="'+d.id+'" href="javascript:;"><i class="fa fa-trash-o"></i></a>')},UploadComplete:function(a,b){$(".delete-image").on("click",function(){var a=$(this).data("id"),b=$(this);$.post("/admin/file/delete?id="+a,{},function(a){var c=JSON.parse(a);c.hasOwnProperty("result")&&b.parents(".photo-zone").hide()})})},Error:function(a,b){document.getElementById("console").innerHTML+="\nError #"+b.code+": "+b.message}}});uploader.init();